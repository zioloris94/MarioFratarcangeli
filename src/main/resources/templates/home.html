<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Home</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <script>
        function fetchClientDetails() {
            const clientId = document.getElementById("clientSelect").value;
            console.log("Cliente selezionato:", clientId);
            if (clientId) {
                fetch(`/client-details/${clientId}`)
                    .then(response => response.json())
                    .then(data => {
                        console.log("Dati ricevuti dal server:", data); // Debug
                        const tableBody = document.getElementById("clientDetailsTable");
                        tableBody.innerHTML = ""; // Svuota la tabella
                        data.forEach(detail => {
                            const row = document.createElement("tr");
                            row.innerHTML = `
                        <td>${detail.date}</td>
                        <td>${detail.description}</td>
                        <td>${detail.hours}</td>
                        <td>${detail.amount}</td>
                    `;
                            tableBody.appendChild(row);
                        });
                    })
                    .catch(error => console.error("Errore durante il recupero dei dettagli del cliente:", error));
            }
        }
    </script>
</head>
<body>

<section>
    <h2>Inserimento Nuovo Lavoro</h2>
    <form th:action="@{/save-client-details}" th:object="${clientDetails}" method="post" class="row g-3">
        <div class="col-md-3">
            <label for="clientId" class="form-label">Cliente:</label>
            <select id="clientId" name="clientId" th:field="*{id}" class="form-select" required>
                <option value="" disabled selected>Seleziona un cliente</option>
                <option th:each="client : ${clientList}" th:value="${client.id}" th:text="${client.name}"></option>
            </select>
        </div>

        <div class="col-md-3">
            <label for="date" class="form-label">Data:</label>
            <input type="date" id="date" name="date" th:field="*{date}" class="form-control" required>
        </div>

        <div class="col-md-3">
            <label for="description" class="form-label">Descrizione:</label>
            <textarea id="description" name="description" th:field="*{description}" class="form-control" required></textarea>
        </div>

        <div class="col-md-2">
            <label for="hours" class="form-label">Ore:</label>
            <input type="number" id="hours" name="hours" th:field="*{hours}" class="form-control" required>
        </div>

        <div class="col-md-2">
            <label for="ratePerHour" class="form-label">Costo Orario:</label>
            <input type="number" id="ratePerHour" name="ratePerHour" th:field="*{ratePerHour}" class="form-control" required>
        </div>

        <div class="col-md-2">
            <label for="travelCost" class="form-label">Costo Viaggio:</label>
            <input type="number" id="travelCost" name="travelCost" th:field="*{travelCost}" class="form-control" required>
        </div>

        <div class="col-md-2">
            <label for="numberPeopleWork" class="form-label">Numero Di Persone:</label>
            <input type="number" id="numberPeopleWork" name="number_people_work" th:field="*{number_people_work}" class="form-control" required>
        </div>

        <div class="col-md-2">
            <button type="submit" class="btn btn-primary mt-3">Salva Lavoro</button>
        </div>
    </form>
</section>


<section>
    <h2>Seleziona Cliente</h2>
    <form id="clientForm">
        <select id="clientSelect" name="clientId" onchange="fetchClientDetails()">
            <option value="" disabled selected>Seleziona un cliente</option>
            <option th:each="client : ${clientList}" th:value="${client.id}" th:text="${client.name}"></option>
        </select>
    </form>
</section>

<section>
    <h2>Lista dei Dettagli del Cliente</h2>
    <table>
        <thead>
        <tr>
            <th>Data</th>
            <th>Descrizione</th>
            <th>Ore</th>
            <th>Importo</th>
        </tr>
        </thead>
        <tbody id="clientDetailsTable">
        </tbody>
    </table>
</section>
</body>
</html>
